"use strict";var io=require("socket.io-client"),SentianceFirehose=function(){var e,n,t=1e3,i=!1,o=function(n,t,i,o){if(!n)throw new Error("No app id configured");if(!t)throw new Error("No stream definition id configured");if(!i)throw new Error("No bearer token configured");if(!e)throw new Error("No data handler configured");a(n,t,i,o)},r=function(e,n,i,r){t*=2,setTimeout(function(){o(e,n,i,r)},t)},a=function(e,n,t,o){var a=new XMLHttpRequest,s={query:"        mutation($app_id: String!, $stream_definition_id: String!, $user_ids: [String]) {          createSubscription(app_id:$app_id, stream_definition_id: $stream_definition_id, user_ids: $user_ids) {            id            token          }        }      ",variables:{app_id:e,stream_definition_id:n,user_ids:o||null}};a.open("POST","https://".concat(i?"preprod-":"","api.sentiance.com/v2/gql"),!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+t),a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){var i=JSON.parse(a.responseText);if(i.data&&i.data.createSubscription){var s=i.data.createSubscription.id,d=i.data.createSubscription.token;c(s,d)}else r(e,n,t,o)}else r(e,n,t,o)},a.send(JSON.stringify(s))},c=function(t,o){(n=io("https://".concat(i?"preprod-":"","firehose.sentiance.com/"))).on("connect",function(){s(n,t,o)}),n.on("data",function(n){var t=JSON.parse(n);e(t.data,t.errors,t.metadata)}),n.on("disconnect",function(){}),n.on("error",function(e){})},s=function(e,n,t){var i={id:n,token:t};e.emit("subscribe-v1",i)};return{connect:function(e,n,t,r,a){i=a,setTimeout(o(e,n,t,r))},disconnect:function(){n&&n.connected&&n.disconnect()},onData:function(n){e=n}}}();module.exports=SentianceFirehose;